<h1>Live Chat</h1>

<div id="chat-box" style="border:1px solid #ccc; height:300px; overflow-y:scroll; margin-bottom:10px;"></div>

<form id="chat-form">
  <input id="chat-input" autocomplete="off" placeholder="Type a message..." required>
  <button type="submit">Send</button>
</form>

<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();
  const chatBox = document.getElementById("chat-box");
  const form = document.getElementById("chat-form");
  const input = document.getElementById("chat-input");

  socket.on("chat:new", (msg) => {
    const div = document.createElement("div");
    const time = new Date(msg.created_at).toLocaleTimeString();
    div.textContent = `[${time}] ${msg.display_name}: ${msg.message}`;
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
  });

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const message = input.value.trim();
    if (!message) return;
    input.value = "";

    await fetch("/api/chat/message", {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: new URLSearchParams({ message })
    });
  });
</script>
